<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stethoscope AI - Instant Server Diagnostics</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap');
        html { scroll-behavior: smooth; }
        body { font-family: 'Inter', sans-serif; background-color: #111827; color: #d1d5db; }
        .btn-primary { background-color: #0ea5e9; color: #ffffff; transition: background-color 0.3s; }
        .btn-primary:hover { background-color: #0284c7; }
        .report-content h2 { font-size: 1.5rem; font-weight: 700; margin-bottom: 1rem; padding-bottom: 0.5rem; border-bottom: 1px solid #374151;}
        .report-content h3 { font-size: 1.25rem; font-weight: 700; }
        .report-content p { margin-top: 0.5rem; line-height: 1.6; }
        .report-content code { background-color: #374151; padding: 0.2rem 0.4rem; border-radius: 0.25rem; }
        .report-content pre { background-color: #1f2937; padding: 1rem; border-radius: 0.5rem; margin-top: 1rem; overflow-x: auto; }
        .report-content table { width: 100%; margin-top: 1rem; border-collapse: collapse; }
        .report-content th, .report-content td { padding: 0.75rem; border: 1px solid #374151; text-align: left; }
        .report-content th { background-color: #1f2937; }
        .issue-card { background-color: #1f2937; border: 1px solid #374151; border-left-width: 4px; padding: 1.5rem; margin-top: 1.5rem; border-radius: 0.5rem; }
        .issue-card.critical { border-left-color: #f87171; }
        .issue-card.warning { border-left-color: #facc15; }
    </style>
</head>
<body class="antialiased">
    <main>
        <!-- HEADER -->
        <header class="p-4 text-center bg-gray-900/50 backdrop-blur-sm sticky top-0 z-10">
            <div class="text-2xl font-black text-white">Stethoscope <span class="text-sky-400">AI</span></div>
        </header>

        <!-- HERO SECTION -->
        <section class="py-20 md:py-24 text-center">
            <div class="container mx-auto px-6">
                <h1 class="text-4xl md:text-5xl font-black text-white leading-tight">Instant, AI-Powered Diagnostics <br> for Your <span class="text-sky-400">Linux Server</span>.</h1>
                <p class="mt-6 text-lg md:text-xl max-w-3xl mx-auto">The expert consultant you need when things go wrong. No agents, no installation, just answers.</p>
            </div>
        </section>

        <!-- THE TOOL SECTION -->
        <section id="analyzer-tool" class="py-12">
            <div class="container mx-auto px-6 max-w-4xl">
                <div class="bg-gray-800 p-8 rounded-lg shadow-2xl">
                    <div class="mb-8">
                        <h3 class="text-xl font-semibold text-white mb-2">Step 1: Copy this command</h3>
                        <div class="bg-gray-900 border border-gray-700 rounded-lg p-4 flex items-center justify-between">
                            <pre><code class="text-gray-300">curl -sSL https://your-netlify-site.netlify.app/analyzer.sh | bash</code></pre>
                            <button onclick="copyCommand()" class="bg-gray-600 hover:bg-gray-500 text-white font-bold py-2 px-4 rounded">Copy</button>
                        </div>
                    </div>
                    <div>
                        <h3 class="text-xl font-semibold text-white mb-2">Step 2: Paste the output & Analyze</h3>
                        <textarea id="snapshot-input" rows="8" class="w-full p-4 rounded-lg bg-gray-900 border border-gray-700 focus:ring-2 focus:ring-sky-500 focus:outline-none" placeholder="Paste your encoded snapshot output here..."></textarea>
                        <button onclick="analyzeServer()" id="analyze-button" class="mt-4 w-full btn-primary font-bold py-4 px-8 rounded-lg text-lg">Analyze My Server</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- RESULTS WRAPPER (Initially Hidden) -->
        <div id="results-wrapper" class="hidden">
             <div class="container mx-auto px-6 max-w-7xl py-20">
                <!-- INSTANT METRICS -->
                <section id="metrics-section" class="mb-16">
                    <h2 class="text-3xl font-bold text-center text-white mb-8">Instant Metrics Snapshot</h2>
                    <div class="grid lg:grid-cols-3 gap-8">
                        <!-- Left Column: Info Cards -->
                        <div class="lg:col-span-1 bg-gray-800 p-6 rounded-lg space-y-4">
                            <h3 class="text-xl font-bold text-white text-center mb-4">System Information</h3>
                            <div class="text-center">
                                <p class="text-sm text-gray-400">Operating System</p>
                                <p id="metric-os" class="text-lg font-semibold text-white">-</p>
                            </div>
                            <div class="text-center">
                                <p class="text-sm text-gray-400">Kernel Version</p>
                                <p id="metric-kernel" class="text-lg font-semibold text-white">-</p>
                            </div>
                            <div class="text-center">
                                <p class="text-sm text-gray-400">Hostname</p>
                                <p id="metric-hostname" class="text-lg font-semibold text-white">-</p>
                            </div>
                            <div class="text-center">
                                <p class="text-sm text-gray-400">Uptime</p>
                                <p id="metric-uptime" class="text-lg font-semibold text-white">-</p>
                            </div>
                        </div>
                        <!-- Right Column: Graphs -->
                        <div class="lg:col-span-2 bg-gray-800 p-6 rounded-lg">
                             <div class="grid md:grid-cols-2 gap-8">
                                 <!-- CPU & Memory -->
                                 <div class="flex flex-col items-center">
                                     <h3 class="text-xl font-bold text-white mb-4">CPU Utilization</h3>
                                     <div class="w-48 h-48 relative"><canvas id="cpuChart"></canvas></div>
                                 </div>
                                 <div class="flex flex-col items-center">
                                     <h3 class="text-xl font-bold text-white mb-4">Memory Usage</h3>
                                     <div class="w-48 h-48 relative"><canvas id="memChart"></canvas></div>
                                 </div>
                             </div>
                             <!-- Disk -->
                             <div class="mt-8">
                                 <h3 class="text-xl font-bold text-white text-center mb-4">Disk Usage</h3>
                                 <div id="disk-charts-container" class="space-y-4"></div>
                             </div>
                        </div>
                    </div>
                </section>
                <!-- AI REPORT -->
                <section id="report-section">
                    <h2 class="text-3xl font-bold text-center text-white mb-8">Your AI-Generated Analysis</h2>
                    <div id="report-output" class="bg-gray-800 border border-gray-700 rounded-lg">
                        <div id="loading-indicator" class="text-center p-8">
                            <svg class="animate-spin h-8 w-8 text-white mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                            <p class="mt-4 text-lg">Your expert AI is analyzing the data...</p>
                        </div>
                        <div id="report-content-wrapper" class="hidden report-content p-6 md:p-8"></div>
                    </div>
                </section>
            </div>
        </div>
        
        <!-- FAQ SECTION -->
        <section id="faq" class="py-20 bg-gray-900">
            <div class="container mx-auto px-6 max-w-4xl">
                <h2 class="text-3xl font-bold text-center text-white mb-12">Frequently Asked Questions</h2>
                <div class="space-y-8">
                    <div>
                        <h3 class="text-xl font-semibold text-white">Why use Stethoscope AI instead of traditional monitoring tools?</h3>
                        <p class="mt-2 text-gray-400">Traditional tools are great for continuous monitoring, but they often tell you *what* is wrong, not *why*. Stethoscope AI is your on-demand expert for when alarms go off. It performs a deep, holistic analysis to find the root cause of complex problems, providing clear explanations and solutions that save you hours of troubleshooting.</p>
                    </div>
                    <div>
                        <h3 class="text-xl font-semibold text-white">Is it safe to run the script on my production server?</h3>
                        <p class="mt-2 text-gray-400">Absolutely. Security is our highest priority. The script is **100% read-only** and agentless. It never installs anything and never makes any changes to your system. It simply reads standard system files, much like you would with commands like `top` or `df`. You can even inspect the script's code before running it for complete peace of mind.</p>
                    </div>
                    <div>
                        <h3 class="text-xl font-semibold text-white">What does "AI-Powered" actually mean here?</h3>
                        <p class="mt-2 text-gray-400">It means we go beyond simple data presentation. After gathering the metrics, we feed them to a powerful Large Language Model (Google's Gemini). The AI acts as an expert system administrator, correlating seemingly unrelated data points, identifying security risks based on context, and generating human-readable reports with actionable solutions, not just raw data.</p>
                    </div>
                    <div>
                        <h3 class="text-xl font-semibold text-white">Do you store any of my server's data?</h3>
                        <p class="mt-2 text-gray-400">No. We have a strict **no-storage policy**. The snapshot data you paste is sent over a secure HTTPS connection, processed in-memory by our backend to generate your report, and then immediately discarded. Your server's information never touches a database on our end.</p>
                    </div>
                    <div>
                        <h3 class="text-xl font-semibold text-white">How is this different from running `top`, `df`, and `ps` myself?</h3>
                        <p class="mt-2 text-gray-400">While you can gather this data yourself, Stethoscope AI's value is in its speed, correlation, and expertise. It automates the entire data collection process, analyzes dozens of data points simultaneously, and uses its AI engine to find connections a human might miss. It turns hours of manual work into a 60-second task, providing not just data, but a complete diagnosis and a treatment plan.</p>
                    </div>
                </div>
            </div>
        </section>
    </main>
    
    <!-- FOOTER -->
    <footer class="bg-gray-900 text-center py-6">
        <p class="text-gray-400 text-sm">Copyright © 2025 Sarper ERKOL. All Rights Reserved.</p>
    </footer>

    <script>
        // --- Chart.js Global Config & Plugins ---
        Chart.defaults.color = '#9ca3af';
        Chart.defaults.borderColor = '#374151';
        const chartTextPlugin = {
            id: 'chartTextPlugin',
            beforeDraw(chart) {
                if (!chart.config.options.plugins.chartTextPlugin || !chart.config.options.plugins.chartTextPlugin.text) return;
                const { width, height, ctx } = chart;
                const text = chart.config.options.plugins.chartTextPlugin.text;
                ctx.restore();
                ctx.font = 'bold 24px Inter';
                ctx.textBaseline = 'middle';
                ctx.fillStyle = '#e5e7eb';
                const textX = Math.round((width - ctx.measureText(text).width) / 2);
                const textY = height / 2;
                ctx.fillText(text, textX, textY);
                ctx.save();
            }
        };

        // --- Global State ---
        let chartInstances = {};
        const API_ENDPOINT = 'https://stethoscope-ai-backend.onrender.com'; // Use your Render URL

        // --- Helper Functions ---
        function copyCommand() {
            const command = document.querySelector('code').innerText;
            navigator.clipboard.writeText(command).then(() => alert('Command copied!'), () => alert('Failed to copy.'));
        }

        function destroyCharts() {
            Object.values(chartInstances).forEach(chart => chart.destroy());
            chartInstances = {};
        }

        function updateMetrics(data) {
            document.getElementById('metric-os').textContent = `${data.os_info.distro} ${data.os_info.version}`;
            document.getElementById('metric-kernel').textContent = data.os_info.kernel;
            document.getElementById('metric-hostname').textContent = data.os_info.hostname;
            const up = data.performance.uptime_seconds;
            const days = Math.floor(up / 86400);
            const hours = Math.floor((up % 86400) / 3600);
            document.getElementById('metric-uptime').textContent = `${days}d ${hours}h`;
        }

        function createCharts(data) {
            destroyCharts();

            // CPU Chart
            const cpuUsage = parseFloat(data.performance.cpu_usage_percent) || 0;
            chartInstances.cpu = new Chart(document.getElementById('cpuChart'), {
                type: 'doughnut',
                data: { datasets: [{ data: [cpuUsage, 100 - cpuUsage], backgroundColor: ['#ef4444', '#374151'], borderColor: '#1f2937', cutout: '70%' }] },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false }, chartTextPlugin: { text: `${cpuUsage.toFixed(1)}%` } } },
                plugins: [chartTextPlugin]
            });

            // Memory Chart
            const memUsed = data.memory.total_kb - data.memory.available_kb;
            const memTotal = data.memory.total_kb;
            const memUsagePercent = memTotal > 0 ? (memUsed / memTotal * 100) : 0;
            chartInstances.mem = new Chart(document.getElementById('memChart'), {
                type: 'doughnut',
                data: { datasets: [{ data: [memUsagePercent, 100 - memUsagePercent], backgroundColor: ['#f59e0b', '#374151'], borderColor: '#1f2937', cutout: '70%' }] },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false }, chartTextPlugin: { text: `${memUsagePercent.toFixed(1)}%` } } },
                plugins: [chartTextPlugin]
            });
            
            // Disk Charts
            const diskContainer = document.getElementById('disk-charts-container');
            diskContainer.innerHTML = '';
            data.disk_usage.forEach((disk) => {
                const diskUsagePercent = parseInt(disk.use_percent.replace('%', ''));
                const diskHtml = `
                    <div class="w-full">
                        <div class="flex justify-between text-sm mb-1">
                            <span>${disk.mount_point}</span>
                            <span>${diskUsagePercent}%</span>
                        </div>
                        <div class="w-full bg-gray-700 rounded-full h-2.5">
                            <div class="bg-sky-500 h-2.5 rounded-full" style="width: ${diskUsagePercent}%"></div>
                        </div>
                    </div>
                `;
                diskContainer.innerHTML += diskHtml;
            });
        }

        function renderReport(reportMarkdown, container) {
            const htmlReport = marked.parse(reportMarkdown);
            const sourceDiv = document.createElement('div');
            sourceDiv.innerHTML = htmlReport;
            const finalReportContainer = document.createElement('div');
            let currentCard = null;
            Array.from(sourceDiv.children).forEach(el => {
                if (el.tagName === 'H3') {
                    currentCard = document.createElement('div');
                    currentCard.className = 'issue-card';
                    if (el.innerText.includes('🔴')) currentCard.classList.add('critical');
                    if (el.innerText.includes('🟡')) currentCard.classList.add('warning');
                    currentCard.appendChild(el);
                    finalReportContainer.appendChild(currentCard);
                } else if (currentCard) {
                    currentCard.appendChild(el);
                } else {
                    finalReportContainer.appendChild(el);
                }
            });
            container.innerHTML = '';
            container.appendChild(finalReportContainer);
        }

        // --- Main Function ---
        async function analyzeServer() {
            const encodedData = document.getElementById('snapshot-input').value.trim();
            if (!encodedData) {
                alert('Please paste the snapshot output before analyzing.');
                return;
            }

            const analyzeButton = document.getElementById('analyze-button');
            const resultsWrapper = document.getElementById('results-wrapper');
            const loadingIndicator = document.getElementById('loading-indicator');
            const reportContentWrapper = document.getElementById('report-content-wrapper');

            resultsWrapper.classList.remove('hidden');
            loadingIndicator.style.display = 'block';
            reportContentWrapper.classList.add('hidden');
            analyzeButton.disabled = true;
            analyzeButton.textContent = 'Analyzing...';
            resultsWrapper.scrollIntoView({ behavior: 'smooth' });
            
            try {
                const serverData = JSON.parse(atob(encodedData));
                updateMetrics(serverData);
                createCharts(serverData);
            } catch (e) {
                reportContentWrapper.innerHTML = `<div class="p-6"><p class="text-red-400"><strong>Analysis Failed:</strong> Invalid data format from script.</p></div>`;
                loadingIndicator.style.display = 'none';
                reportContentWrapper.classList.remove('hidden');
                analyzeButton.disabled = false;
                analyzeButton.textContent = 'Analyze My Server';
                return;
            }

            try {
                const response = await fetch(`${API_ENDPOINT}/api/v1/analyze`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ data: encodedData }),
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.detail || `HTTP error! status: ${response.status}`);
                }

                const result = await response.json();
                renderReport(result.report, reportContentWrapper);

            } catch (error) {
                reportContentWrapper.innerHTML = `<div class="p-6"><p class="text-red-400"><strong>Analysis Failed:</strong> ${error.message}</p></div>`;
            } finally {
                loadingIndicator.style.display = 'none';
                reportContentWrapper.classList.remove('hidden');
                analyzeButton.disabled = false;
                analyzeButton.textContent = 'Analyze My Server';
            }
        }
    </script>
</body>
</html>
